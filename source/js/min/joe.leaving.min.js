"use strict";function _createForOfIteratorHelper(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,t=function(){};return{s:t,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:t}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){i=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(i)throw a}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var leavingContext={getData:function(){var e=$(".joe_detail__title").attr("data-sheetid"),t=$(".joe_leaving-list"),n=$(".joe_leaving-none"),r=$(".joe_loading");Utils.request("/api/content/sheets/".concat(e,"/comments/top_view"),"GET",{page:0,sort:"createTime,desc"}).then(function(e){e.total?(e=e.content.reduce(function(e,t){var n=t,r=(n.content||"").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&apos;/g,"'").split('<i style="display: none;" class="qiushaocloud_comment_extra_json">');if(r&&2<=r.length){n.content=r[0]||"";var a=r[1];if(a)try{var o=JSON.parse(window.decodeURIComponent(a.substring(0,a.lastIndexOf("</i>")))),i=o.avatar,c=o.ip,l=o.location;n.avatarFromContent=i,n.ipAddress===c&&(n.ipLocation=l)}catch(e){console.error("JSON.parse catch err:",e,r,n)}}n=n.children;if(n&&Array.isArray(n)&&n.length){var d,s=_createForOfIteratorHelper(n);try{for(s.s();!(d=s.n()).done;){var f=d.value;formatResComment(f),f.children||(f.children=[])}}catch(e){s.e(e)}finally{s.f()}}t.content.trim()&&(p=marked(t.content).replace(/<img\ssrc[^>]*>/gm,"[图片内容]").replace(/bili\//g,"bili/hd/ic_emoji_"),p=Utils.renderedEmojiHtml(p),t.content=Utils.return2Br(p));var p=t.avatarFromContent||"".concat(ThemeConfig.gravatar_source||ThemeConfig.gravatar_source_url,"/").concat(t.gravatarMd5,"?s=256&d=").concat(ThemeConfig.gravatar_type);return e+'<li class="item">\n            <div class="user">\n                <img class="avatar lazyload" src="'.concat(ThemeConfig.lazyload_avatar,'" data-src="').concat(p,'" alt="用户头像" onerror="this.src=\'').concat(ThemeConfig.comment_avatar_error,'\'"/>\n                <div class="nickname">').concat(t.author,'</div>\n                <div class="date">').concat(new Date(t.createTime).toLocaleDateString(),'</div>\n            </div>\n            <div class="wrapper">\n                <div class="content leaving-content">').concat(t.content,"</div>\n            </div>\n        </li>")},""),t.html(e),leavingContext.randomColor()):(t.hide(),n.show()),r&&r.hide()}).catch(function(e){r&&r.hide(),t.hide(),n.show()})},setEmptyText:function(){ThemeConfig.leaving_empty_text&&"暂无留言，期待第一个脚印。"!==ThemeConfig.leaving_empty_text.trim()&&$(".joe_leaving-none").text(ThemeConfig.leaving_empty_text)},randomColor:function(){function i(e,t){return Math.floor(Math.random()*(t-e+1))+e}var c=100,l=["#dcc10c","#299bec","#ea5455","#7367f0","#32ccbb","#f6416c","#28c76f","#9f44d3","#f55555","#736efe","#e96d71","#de4313","#d939cd","#4c83ff","#f072b6","#c346c2","#5961f9","#fd6585","#465efb","#ffc600","#fa742b","#5151e5","#bb4e75","#e255cd","#63c549","#0ecdde","#f067b4","#f067b4","#ff9a9e","#1dd5de","#4facfe","#f093fb","#6fa3ef","#bc99c4","#46c47c","#f9bb3c","#e8583d","#f68e5f"],e=$(".joe_leaving-list"),d=e.width(),s=e.height(),f=["20px 300px","20px 400px","20px 500px","30px 300px","30px 400px","30px 500px","40px 300px","40px 400px","40px 500px"],p=["300px 20px","400px 20px","500px 20px","300px 30px","400px 30px","500px 30px","300px 40px","400px 40px","500px 40px"];$(".joe_leaving-list .item").each(function(e,t){var n=i(1,99),r=l[i(0,l.length-1)],a=Math.ceil($(t).width()),o=Math.ceil($(t).height()),o=i(0,s-o),a=i(0,d-a);$(t).css({display:"block",zIndex:n,background:r,top:o,left:a,borderTopLeftRadius:p[i(0,p.length-1)],borderTopRightRadius:f[i(0,f.length-1)],borderBottomLeftRadius:f[i(0,f.length-1)],borderBottomRightRadius:f[i(0,f.length-1)]}),$(t).draggabilly({containment:!0}),$(t).on("dragStart",function(e){c++,$(t).css({zIndex:c})})})}};document.addEventListener("DOMContentLoaded",function(){leavingContext.setEmptyText(),leavingContext.getData()});